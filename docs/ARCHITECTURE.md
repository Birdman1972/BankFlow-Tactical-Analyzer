# ç³»çµ±æ¶æ§‹æ–‡ä»¶

## ç›®éŒ„

- [æ¶æ§‹ç¸½è¦½](#æ¶æ§‹ç¸½è¦½)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)
- [å‰ç«¯æ¶æ§‹](#å‰ç«¯æ¶æ§‹)
- [å¾Œç«¯æ¶æ§‹](#å¾Œç«¯æ¶æ§‹)
- [è³‡æ–™æµè¨­è¨ˆ](#è³‡æ–™æµè¨­è¨ˆ)
- [æ ¸å¿ƒæ¼”ç®—æ³•](#æ ¸å¿ƒæ¼”ç®—æ³•)
- [å®‰å…¨è¨­è¨ˆ](#å®‰å…¨è¨­è¨ˆ)

---

## æ¶æ§‹ç¸½è¦½

### ä¸‰å±¤å¼æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚                         ğŸ–¥ï¸  è¡¨ ç¾ å±¤  (Presentation)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         Svelte å‰ç«¯                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚  â”‚DropZone  â”‚  â”‚ControlPadâ”‚  â”‚ LogPanel â”‚  â”‚ ResultTblâ”‚           â”‚  â”‚
â”‚  â”‚  â”‚ æ‹–æ›³å€   â”‚  â”‚ æ§åˆ¶é¢æ¿  â”‚  â”‚ æ—¥èªŒå€   â”‚  â”‚ çµæœè¡¨æ ¼ â”‚           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚                         ğŸ”—  æ©‹ æ¥ å±¤  (Bridge)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       Tauri IPC Commands                           â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚   invoke('load_file')    invoke('analyze')    invoke('export')    â”‚  â”‚
â”‚  â”‚          â”‚                     â”‚                    â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                     â”‚                    â”‚                 â”‚
â”‚             â–¼                     â–¼                    â–¼                 â”‚
â”‚                         âš™ï¸  æ¥­ å‹™ å±¤  (Business)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Rust æ ¸å¿ƒå¼•æ“                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚  â”‚ Parser   â”‚  â”‚ Matcher  â”‚  â”‚ Whois    â”‚  â”‚ Exporter â”‚           â”‚  â”‚
â”‚  â”‚  â”‚ Excelè§£æâ”‚  â”‚ IPæ¯”å°   â”‚  â”‚ ç¶²è·¯æŸ¥è©¢ â”‚  â”‚ å ±å‘ŠåŒ¯å‡º â”‚           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›®éŒ„çµæ§‹

```
BankFlow-Tactical-Analyzer/
â”‚
â”œâ”€â”€ ğŸ“ src-tauri/                    # Rust å¾Œç«¯
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ main.rs              # Tauri æ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ lib.rs               # æ¨¡çµ„åŒ¯å‡ºèˆ‡åˆå§‹åŒ–
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ commands/            # Tauri å‘½ä»¤å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ mod.rs           # å‘½ä»¤æ¨¡çµ„åŒ¯å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ file_ops.rs      # æª”æ¡ˆè¼‰å…¥/åŒ¯å‡ºå‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ analysis.rs      # åˆ†æåŸ·è¡Œå‘½ä»¤
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ whois.rs         # Whois æŸ¥è©¢å‘½ä»¤
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ core/                # æ ¸å¿ƒæ¥­å‹™é‚è¼¯
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ mod.rs           # æ ¸å¿ƒæ¨¡çµ„åŒ¯å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ parser.rs        # Excel æª”æ¡ˆè§£æå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ matcher.rs       # IP æ™‚é–“çª—å£æ¯”å°å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ processor.rs     # è³‡æ–™å‰è™•ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ exporter.rs      # Excel å ±å‘Šç”¢ç”Ÿå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ models/              # è³‡æ–™æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ transaction.rs   # äº¤æ˜“è³‡æ–™çµæ§‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ip_record.rs     # IP ç´€éŒ„çµæ§‹
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ analysis.rs      # åˆ†æçµæœçµæ§‹
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/               # å·¥å…·å‡½å¼
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ mod.rs
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ datetime.rs      # æ™‚é–“è™•ç†å·¥å…·
â”‚   â”‚       â””â”€â”€ ğŸ“„ error.rs         # éŒ¯èª¤è™•ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ Cargo.toml               # Rust ä¾è³´é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tauri.conf.json          # Tauri æ‡‰ç”¨é…ç½®
â”‚   â””â”€â”€ ğŸ“„ build.rs                 # å»ºæ§‹è…³æœ¬
â”‚
â”œâ”€â”€ ğŸ“ src/                          # Svelte å‰ç«¯
â”‚   â”œâ”€â”€ ğŸ“ lib/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/          # UI å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DropZone.svelte      # æª”æ¡ˆæ‹–æ›³å€
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ControlPanel.svelte  # åŠŸèƒ½æ§åˆ¶é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LogConsole.svelte    # å³æ™‚æ—¥èªŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ResultTable.svelte   # çµæœé è¦½è¡¨æ ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ProgressBar.svelte   # é€²åº¦æ¢
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ WarningBanner.svelte # OpSec è­¦å‘Šæ©«å¹…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ stores/              # ç‹€æ…‹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ files.ts         # æª”æ¡ˆç‹€æ…‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ settings.ts      # è¨­å®šç‹€æ…‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ analysis.ts      # åˆ†æçµæœç‹€æ…‹
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ logs.ts          # æ—¥èªŒç‹€æ…‹
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/               # å‰ç«¯å·¥å…·
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ tauri.ts         # Tauri API å°è£
â”‚   â”‚       â””â”€â”€ ğŸ“„ formatters.ts    # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ App.svelte               # ä¸»æ‡‰ç”¨ç¨‹å¼å…ƒä»¶
â”‚   â”œâ”€â”€ ğŸ“„ main.ts                  # å‰ç«¯å…¥å£é»
â”‚   â””â”€â”€ ğŸ“„ app.css                  # å…¨åŸŸæ¨£å¼ï¼ˆè³½åšé¾å…‹ä¸»é¡Œï¼‰
â”‚
â”œâ”€â”€ ğŸ“ tests/                        # æ¸¬è©¦
â”‚   â”œâ”€â”€ ğŸ“ fixtures/                # æ¸¬è©¦ç”¨ Excel æª”æ¡ˆ
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ sample_transactions.xlsx
â”‚   â”‚   â””â”€â”€ ğŸ“„ sample_ip_logs.xlsx
â”‚   â””â”€â”€ ğŸ“ rust/                    # Rust å–®å…ƒæ¸¬è©¦
â”‚
â”œâ”€â”€ ğŸ“ docs/                         # æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ PROJECT.md               # å°ˆæ¡ˆç¸½è¦½
â”‚   â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md          # æ¶æ§‹æ–‡ä»¶ï¼ˆæœ¬æª”æ¡ˆï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ USER_GUIDE.md            # ä½¿ç”¨è€…æŒ‡å—
â”‚   â”œâ”€â”€ ğŸ“„ TECHNICAL_SPEC.md        # æŠ€è¡“è¦æ ¼
â”‚   â””â”€â”€ ğŸ“ plans/                   # é–‹ç™¼è¨ˆç•«
â”‚
â”œâ”€â”€ ğŸ“„ package.json                  # Node.js ä¾è³´
â”œâ”€â”€ ğŸ“„ vite.config.ts               # Vite å»ºæ§‹é…ç½®
â”œâ”€â”€ ğŸ“„ svelte.config.js             # Svelte é…ç½®
â”œâ”€â”€ ğŸ“„ README.md                    # å°ˆæ¡ˆèªªæ˜
â””â”€â”€ ğŸ“„ LICENSE                      # MIT æˆæ¬Š
```

---

## å‰ç«¯æ¶æ§‹

### å…ƒä»¶éšå±¤

```mermaid
graph TB
    subgraph App["App.svelte"]
        Header["Header<br/>æ¨™é¡Œå€"]

        subgraph Main["ä¸»è¦å…§å®¹å€"]
            subgraph FileSection["æª”æ¡ˆè¼¸å…¥å€"]
                DropA["DropZone A<br/>å­˜æ¬¾æ˜ç´°"]
                DropB["DropZone B<br/>IP ç´€éŒ„"]
            end

            Control["ControlPanel<br/>æ§åˆ¶é¢æ¿"]

            subgraph ActionSection["å‹•ä½œå€"]
                ExecBtn["ExecuteButton<br/>åŸ·è¡Œåˆ†æ"]
                Progress["ProgressBar<br/>é€²åº¦æ¢"]
            end

            Warning["WarningBanner<br/>OpSec è­¦å‘Š"]
        end

        subgraph Output["è¼¸å‡ºå€"]
            Result["ResultTable<br/>çµæœé è¦½"]
            Download["DownloadButton<br/>ä¸‹è¼‰å ±å‘Š"]
        end

        LogConsole["LogConsole<br/>æ—¥èªŒæ§åˆ¶å°"]
    end

    style App fill:#111827,stroke:#00D2FF,color:#E5E7EB
    style Main fill:#1F2937,stroke:#00FF9D,color:#E5E7EB
    style FileSection fill:#374151,stroke:#00D2FF,color:#E5E7EB
    style ActionSection fill:#374151,stroke:#00FF9D,color:#E5E7EB
    style Output fill:#1F2937,stroke:#00FF9D,color:#E5E7EB
```

### ç‹€æ…‹ç®¡ç†è¨­è¨ˆ

```mermaid
flowchart LR
    subgraph Stores["Svelte Stores"]
        FS["filesStore<br/>æª”æ¡ˆç‹€æ…‹"]
        SS["settingsStore<br/>è¨­å®šç‹€æ…‹"]
        AS["analysisStore<br/>åˆ†æç‹€æ…‹"]
        LS["logsStore<br/>æ—¥èªŒç‹€æ…‹"]
    end

    subgraph Components["å…ƒä»¶"]
        DZ["DropZone"]
        CP["ControlPanel"]
        RT["ResultTable"]
        LC["LogConsole"]
    end

    DZ -->|update| FS
    CP -->|update| SS
    FS -->|subscribe| RT
    AS -->|subscribe| RT
    LS -->|subscribe| LC

    style Stores fill:#2d2d44,stroke:#00FF9D,color:#E5E7EB
    style Components fill:#2d2d44,stroke:#00D2FF,color:#E5E7EB
```

---

## å¾Œç«¯æ¶æ§‹

### Rust æ¨¡çµ„é—œä¿‚

```mermaid
flowchart TB
    subgraph Commands["commands/"]
        file_ops["file_ops.rs"]
        analysis["analysis.rs"]
        whois["whois.rs"]
    end

    subgraph Core["core/"]
        parser["parser.rs"]
        matcher["matcher.rs"]
        processor["processor.rs"]
        exporter["exporter.rs"]
    end

    subgraph Models["models/"]
        transaction["Transaction"]
        ip_record["IpRecord"]
        result["AnalysisResult"]
    end

    subgraph External["å¤–éƒ¨ crates"]
        calamine["calamine<br/>Excel è®€å–"]
        xlsxwriter["rust_xlsxwriter<br/>Excel å¯«å…¥"]
        reqwest["reqwest<br/>HTTP è«‹æ±‚"]
        chrono["chrono<br/>æ™‚é–“è™•ç†"]
    end

    file_ops --> parser
    file_ops --> exporter
    analysis --> processor
    analysis --> matcher
    whois --> reqwest

    parser --> calamine
    parser --> transaction
    parser --> ip_record

    matcher --> transaction
    matcher --> ip_record
    matcher --> result
    matcher --> chrono

    exporter --> xlsxwriter
    exporter --> result

    style Commands fill:#1a1a2e,stroke:#FF0055,color:#E5E7EB
    style Core fill:#1a1a2e,stroke:#00FF9D,color:#E5E7EB
    style Models fill:#1a1a2e,stroke:#00D2FF,color:#E5E7EB
    style External fill:#2d2d44,stroke:#666,color:#E5E7EB
```

### è³‡æ–™çµæ§‹å®šç¾©

```rust
// models/transaction.rs
pub struct Transaction {
    pub timestamp: DateTime<Local>,     // äº¤æ˜“æ™‚é–“
    pub account: String,                 // å¸³è™Ÿ
    pub income: Option<f64>,             // å­˜å…¥é‡‘é¡ (Jæ¬„)
    pub expense: Option<f64>,            // æ”¯å‡ºé‡‘é¡ (Iæ¬„)
    pub raw_columns: Vec<String>,        // åŸå§‹æ¬„ä½è³‡æ–™
    pub matched_ip: Option<String>,      // æ¯”å°çµæœ IP
    pub ip_country: Option<String>,      // Whois åœ‹ç±
    pub ip_isp: Option<String>,          // Whois ISP
}

// models/ip_record.rs
pub struct IpRecord {
    pub timestamp: DateTime<Local>,     // ç™»å…¥æ™‚é–“
    pub account: String,                 // å¸³è™Ÿ
    pub ip_address: String,              // IP ä½å€
}

// models/analysis.rs
pub struct AnalysisResult {
    pub summary: Vec<Transaction>,       // ç¸½è¡¨
    pub income: Vec<Transaction>,        // å­˜å…¥è¡¨
    pub expense: Vec<Transaction>,       // æ”¯å‡ºè¡¨
    pub stats: AnalysisStats,            // çµ±è¨ˆè³‡è¨Š
}

pub struct AnalysisStats {
    pub total_records: usize,            // ç¸½ç­†æ•¸
    pub matched_count: usize,            // æ¯”å°æˆåŠŸæ•¸
    pub multi_ip_count: usize,           // å¤š IP æ•¸
    pub whois_queried: usize,            // Whois æŸ¥è©¢æ•¸
}
```

---

## è³‡æ–™æµè¨­è¨ˆ

### å®Œæ•´è³‡æ–™æµç¨‹

```mermaid
flowchart TB
    subgraph Input["è¼¸å…¥éšæ®µ"]
        U["ä½¿ç”¨è€…"] -->|æ‹–æ›³| F1["æª”æ¡ˆ A.xlsx"]
        U -->|æ‹–æ›³| F2["æª”æ¡ˆ B.xlsx"]
    end

    subgraph Frontend["å‰ç«¯è™•ç†"]
        F1 --> V1["é©—è­‰æ ¼å¼"]
        F2 --> V2["é©—è­‰æ ¼å¼"]
        V1 --> S1["æ›´æ–° fileStore"]
        V2 --> S1
    end

    subgraph Bridge["Tauri æ©‹æ¥"]
        S1 -->|invoke load_file| CMD1["file_ops::load"]
        CMD1 -->|å›å‚³| META["æª”æ¡ˆå…ƒè³‡æ–™"]
    end

    subgraph RustParse["Rust è§£æ"]
        CMD1 --> P1["parser::parse_transactions"]
        CMD1 --> P2["parser::parse_ip_records"]
        P1 --> DF1["Vec&lt;Transaction&gt;"]
        P2 --> DF2["Vec&lt;IpRecord&gt;"]
    end

    subgraph RustProcess["Rust è™•ç†"]
        DF1 --> PP["processor::preprocess"]
        PP -->|éš±è—æ•æ„Ÿæ¬„ä½| PP
        PP -->|æ”¶æ”¯åˆ†æµ| SPLIT["åˆ†é›¢ income/expense"]
    end

    subgraph RustMatch["Rust æ¯”å°"]
        SPLIT --> M["matcher::match_ip"]
        DF2 --> M
        M -->|å»ºç«‹ç´¢å¼•| IDX["HashMap&lt;account, Vec&lt;IpRecord&gt;&gt;"]
        M -->|æ™‚é–“çª—å£| WINDOW["[-1s, +2s] ç¯©é¸"]
        WINDOW --> RESULT["æ¯”å°çµæœ"]
    end

    subgraph RustWhois["Rust Whois"]
        RESULT -->|å¦‚æœå•Ÿç”¨| W["whois::query"]
        W -->|HTTP GET| API["ip-api.com"]
        API --> WR["åœ‹ç± + ISP"]
        WR --> RESULT
    end

    subgraph Output["è¼¸å‡ºéšæ®µ"]
        RESULT --> E["exporter::to_excel"]
        E --> XLSX["å ±å‘Š.xlsx"]
        XLSX --> DL["ä¸‹è¼‰"]
        DL --> U
    end

    style Input fill:#1a1a2e,stroke:#00D2FF,color:#E5E7EB
    style Frontend fill:#1a1a2e,stroke:#00D2FF,color:#E5E7EB
    style Bridge fill:#1a1a2e,stroke:#00FF9D,color:#E5E7EB
    style RustParse fill:#1a1a2e,stroke:#FF0055,color:#E5E7EB
    style RustProcess fill:#1a1a2e,stroke:#FF0055,color:#E5E7EB
    style RustMatch fill:#1a1a2e,stroke:#FF0055,color:#E5E7EB
    style RustWhois fill:#1a1a2e,stroke:#FF0055,color:#E5E7EB
    style Output fill:#1a1a2e,stroke:#00FF9D,color:#E5E7EB
```

---

## æ ¸å¿ƒæ¼”ç®—æ³•

### IP æ™‚é–“çª—å£æ¯”å°æ¼”ç®—æ³•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        IP æ™‚é–“çª—å£æ¯”å°æ¼”ç®—æ³•                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  è¼¸å…¥ï¼š                                                                      â”‚
â”‚    â€¢ transactions: Vec<Transaction>  (æª”æ¡ˆ A çš„äº¤æ˜“ç´€éŒ„)                     â”‚
â”‚    â€¢ ip_records: Vec<IpRecord>       (æª”æ¡ˆ B çš„ IP ç´€éŒ„)                     â”‚
â”‚                                                                             â”‚
â”‚  æ­¥é©Ÿï¼š                                                                      â”‚
â”‚                                                                             â”‚
â”‚    1. å»ºç«‹ IP ç´€éŒ„ç´¢å¼• (O(n))                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚       â”‚  HashMap<String, Vec<IpRecord>>            â”‚                        â”‚
â”‚       â”‚  Key: account (å¸³è™Ÿ)                        â”‚                        â”‚
â”‚       â”‚  Value: è©²å¸³è™Ÿçš„æ‰€æœ‰ IP ç™»å…¥ç´€éŒ„            â”‚                        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                             â”‚
â”‚    2. å°æ¯ç­†äº¤æ˜“é€²è¡Œæ¯”å° (O(m * k))                                          â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚       â”‚  for each transaction T:                   â”‚                        â”‚
â”‚       â”‚    records = index[T.account]              â”‚                        â”‚
â”‚       â”‚    matches = filter(records) where:        â”‚                        â”‚
â”‚       â”‚      T.time - 1s <= record.time <= T.time + 2s                      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                             â”‚
â”‚    3. æ ¼å¼åŒ–è¼¸å‡º                                                             â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚       â”‚  ç„¡åŒ¹é…     â†’ "N/A"                         â”‚                        â”‚
â”‚       â”‚  å–®ä¸€ IP    â†’ "192.168.1.1"                 â”‚                        â”‚
â”‚       â”‚  å¤šç›¸åŒ IP  â†’ "192.168.1.1" (å»é‡)          â”‚                        â”‚
â”‚       â”‚  å¤šä¸åŒ IP  â†’ "+1s:8.8.8.8 | -1s:1.1.1.1"  â”‚                        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                             â”‚
â”‚  æ™‚é–“è¤‡é›œåº¦ï¼šO(n + m * k)                                                    â”‚
â”‚    n = IP ç´€éŒ„æ•¸é‡                                                          â”‚
â”‚    m = äº¤æ˜“ç´€éŒ„æ•¸é‡                                                          â”‚
â”‚    k = å¹³å‡æ¯å¸³è™Ÿçš„ IP ç´€éŒ„æ•¸                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ™‚é–“çª—å£è¦–è¦ºåŒ–

```
         äº¤æ˜“æ™‚é–“ T
              â”‚
              â–¼
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
              â”‚
    â—„â”€â”€ -1s â”€â”€â”¼â”€â”€â”€â”€â”€â”€ +2s â”€â”€â”€â–º
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      æœ‰æ•ˆåŒ¹é…å€é–“          â”‚
    â”‚   [T-1ç§’, T, T+1ç§’, T+2ç§’] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ç¯„ä¾‹ï¼š
    äº¤æ˜“æ™‚é–“: 2024-01-15 14:30:00

    IP ç™»å…¥ç´€éŒ„:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç™»å…¥æ™‚é–“             â”‚ IP             â”‚ æ˜¯å¦åŒ¹é…  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ 14:29:58            â”‚ 8.8.8.8        â”‚ âŒ è¶…å‡º   â”‚
    â”‚ 14:29:59            â”‚ 1.1.1.1        â”‚ âœ… -1s    â”‚
    â”‚ 14:30:00            â”‚ 2.2.2.2        â”‚ âœ… 0s     â”‚
    â”‚ 14:30:01            â”‚ 3.3.3.3        â”‚ âœ… +1s    â”‚
    â”‚ 14:30:02            â”‚ 4.4.4.4        â”‚ âœ… +2s    â”‚
    â”‚ 14:30:03            â”‚ 5.5.5.5        â”‚ âŒ è¶…å‡º   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    è¼¸å‡º: "-1s:1.1.1.1 | 0s:2.2.2.2 | +1s:3.3.3.3 | +2s:4.4.4.4"
```

---

## å®‰å…¨è¨­è¨ˆ

### å®‰å…¨æ¶æ§‹

```mermaid
flowchart TB
    subgraph Security["å®‰å…¨è¨­è¨ˆ"]
        subgraph Offline["é›¢ç·šä¿è­·"]
            O1["æœ¬æ©Ÿé‹ç®—"]
            O2["ç„¡é›²ç«¯ä¸Šå‚³"]
            O3["è¨˜æ†¶é«”è™•ç†"]
        end

        subgraph Memory["è¨˜æ†¶é«”å®‰å…¨"]
            M1["Rust æ‰€æœ‰æ¬Š"]
            M2["è‡ªå‹•æ¸…ç†"]
            M3["ç„¡ GC æš«åœ"]
        end

        subgraph OpSec["è¡Œå‹•å®‰å…¨"]
            OS1["Whois é è¨­é—œé–‰"]
            OS2["ç´…è‰²è­¦å‘Šé¡¯ç¤º"]
            OS3["ä½¿ç”¨è€…ç¢ºèª"]
        end

        subgraph Data["è³‡æ–™ä¿è­·"]
            D1["æ•æ„Ÿæ¬„ä½éš±è—"]
            D2["ä¸ç”¢ç”Ÿæš«å­˜æª”"]
            D3["è™•ç†å¾Œæ¸…é™¤"]
        end
    end

    style Security fill:#111827,stroke:#FF0055,color:#E5E7EB
    style Offline fill:#1F2937,stroke:#00FF9D,color:#E5E7EB
    style Memory fill:#1F2937,stroke:#00FF9D,color:#E5E7EB
    style OpSec fill:#1F2937,stroke:#FF0055,color:#E5E7EB
    style Data fill:#1F2937,stroke:#00D2FF,color:#E5E7EB
```

### å®‰å…¨æª¢æŸ¥æ¸…å–®

| é¡åˆ¥ | é …ç›® | èªªæ˜ |
|------|------|------|
| **é›¢ç·š** | ç„¡ç¶²è·¯ä¾è³´ | é™¤ Whois å¤–ï¼Œæ‰€æœ‰åŠŸèƒ½é›¢ç·šå¯ç”¨ |
| **è¨˜æ†¶é«”** | Rust å®‰å…¨ | ç·¨è­¯æ™‚è¨˜æ†¶é«”å®‰å…¨æª¢æŸ¥ |
| **è¨˜æ†¶é«”** | è‡ªå‹•æ¸…ç† | åˆ†æå®Œæˆå¾Œè‡ªå‹•é‡‹æ”¾è³‡æ–™ |
| **OpSec** | Whois è­¦å‘Š | é€£ç·šå‰é¡¯ç¤ºç´…è‰²è­¦å‘Š |
| **OpSec** | é è¨­é—œé–‰ | ç¶²è·¯åŠŸèƒ½é è¨­ä¸å•Ÿç”¨ |
| **è³‡æ–™** | æ¬„ä½éš±è— | å¯é¸æ“‡ç§»é™¤æ•æ„Ÿæ¬„ä½ |
| **è³‡æ–™** | ç„¡æš«å­˜ | ä¸å¯«å…¥ä»»ä½•ä¸­é–“æª”æ¡ˆ |

---

<div align="center">

*æœ¬æ–‡ä»¶ç‚º BankFlow Tactical Analyzer æŠ€è¡“æ¶æ§‹èªªæ˜*

</div>
