# BankFlow 金流分析器 使用手冊

**版本**：2.0.0
**最後更新**：2026-01-23

---

## 目錄

1. [簡介](#簡介)
2. [系統需求](#系統需求)
3. [安裝指南](#安裝指南)
4. [快速入門](#快速入門)
5. [功能說明](#功能說明)
6. [操作流程](#操作流程)
7. [輸出報告](#輸出報告)
8. [常見問題](#常見問題)
9. [技術架構](#技術架構)

---

## 簡介

### 什麼是 BankFlow 金流分析器？

BankFlow 金流分析器 是一款專為數位鑑識設計的金流分析工具，主要用於：

- **銀行交易紀錄分析**：解析 Excel 格式的銀行交易明細
- **IP 登入日誌比對**：將交易時間與 IP 登入紀錄進行時間窗口匹配
- **可疑活動識別**：找出同一帳戶在交易時間前後的 IP 登入紀錄
- **報告匯出**：產生結構化的 Excel 分析報告

### 適用場景

- 金融詐欺調查
- 洗錢防制分析
- 帳戶異常行為偵測
- 數位鑑識證據整理

### 雙平台支援

| 平台 | 網址/方式 | 特點 |
|------|----------|------|
| **Web 版** | https://bankflow-tactical-analyzer.vercel.app | 無需安裝，瀏覽器直接使用 |
| **桌面版** | Tauri 應用程式 | 完整功能，支援 Whois 查詢 |

---

## 系統需求

### Web 版本

- **瀏覽器**：Chrome 90+、Firefox 90+、Safari 15+、Edge 90+
- **需支援**：WebAssembly (WASM)
- **網路**：需連網存取 Vercel 部署站點

### 桌面版本

| 項目 | 最低需求 |
|------|---------|
| 作業系統 | Windows 10+、macOS 11+、Linux |
| 記憶體 | 4GB RAM |
| 硬碟空間 | 100MB |

---

## 安裝指南

### Web 版本（推薦）

無需安裝，直接訪問：

👉 **https://bankflow-tactical-analyzer.vercel.app**

### 桌面版本

#### 從原始碼建置

```bash
# 1. 複製專案
git clone https://github.com/Birdman1972/BankFlow-Tactical-Analyzer.git
cd BankFlow-Tactical-Analyzer

# 2. 安裝依賴
npm install

# 3. 開發模式執行
npm run dev:tauri

# 4. 建置正式版
npm run build:tauri
```

---

## 快速入門

### 步驟一：準備檔案

您需要準備兩個 Excel 檔案：

#### File A - 交易紀錄檔

| 必要欄位 | 說明 | 範例 |
|---------|------|------|
| 時間戳記 | 交易發生時間 | 2024-01-15 10:30:00 |
| 帳號 | 交易帳戶識別碼 | ACC001 |
| 收入金額 | 入帳金額（可選） | 10000 |
| 支出金額 | 出帳金額（可選） | 5000 |

#### File B - IP 登入日誌

| 必要欄位 | 說明 | 範例 |
|---------|------|------|
| 時間戳記 | 登入時間 | 2024-01-15 10:30:01 |
| 帳號 | 登入帳戶識別碼 | ACC001 |
| IP 位址 | 登入來源 IP | 192.168.1.100 |

### 步驟二：載入檔案

1. 點擊「選擇 File A」按鈕，選取交易紀錄檔
2. 點擊「選擇 File B」按鈕，選取 IP 登入日誌
3. 確認兩個檔案都顯示載入成功

### 步驟三：設定分析選項

| 選項 | 說明 | 預設值 |
|------|------|--------|
| 隱藏敏感欄位 | 移除指定的敏感資料欄位 | 關閉 |
| 收支分開 | 將收入與支出分開列表 | 開啟 |
| IP 交叉比對 | 執行 IP 時間窗口匹配 | 開啟 |
| Whois 查詢 | 查詢 IP 地理位置與 ISP（僅桌面版） | 關閉 |

### 步驟四：執行分析

點擊「開始分析」按鈕，等待分析完成。

### 步驟五：匯出報告

分析完成後，點擊「匯出 Excel」下載分析報告。

---

## 功能說明

### 1. IP 時間窗口匹配

#### 原理

系統會比對每筆交易的時間戳記，尋找同一帳戶在指定時間窗口內的 IP 登入紀錄。

#### 時間窗口設定

- **預設值**：交易前 1 秒 ~ 交易後 2 秒
- **匹配邏輯**：
  ```
  交易時間 - 1秒 ≤ IP登入時間 ≤ 交易時間 + 2秒
  ```

#### 匹配結果格式

| 情況 | 顯示格式 | 說明 |
|------|---------|------|
| 單一 IP 匹配 | `192.168.1.1` | 找到一個匹配的 IP |
| 多個 IP 匹配 | `-1s:192.168.1.1 \| +2s:10.0.0.1` | 多個 IP，顯示時間偏移 |
| 無匹配 | `N/A` | 時間窗口內無 IP 紀錄 |

### 2. 敏感欄位隱藏

可自動移除指定的敏感資料欄位（C/F/L/M），預設移除欄位索引：2, 5, 11, 12。

在本專案的測試用 canonical schema 中，對應欄位為：

- C (2)：身分證字號
- F (5)：交易序號
- L (11)：對方帳號
- M (12)：對方戶名

### 3. 收支分離

將交易紀錄依據收入/支出分開，便於分類分析：

- **收入交易**：income > 0 的紀錄
- **支出交易**：expense > 0 的紀錄

### 4. Whois IP 查詢（僅桌面版）

查詢 IP 的地理位置與網路服務提供商：

| 欄位 | 說明 | 範例 |
|------|------|------|
| Country | IP 所屬國家 | TW |
| ISP | 網路服務商 | Chunghwa Telecom |

**注意**：
- Web 版因瀏覽器 CORS 限制無法使用此功能
- 私有 IP（如 192.168.x.x）會自動標記為「Private/Local Network」

---

## 操作流程

### 完整操作流程圖

```
┌─────────────────┐
│   載入 File A    │ ← 交易紀錄 Excel
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   載入 File B    │ ← IP 登入日誌 Excel
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   設定分析選項   │
│  □ 隱藏敏感欄位  │
│  □ 收支分開     │
│  □ IP 交叉比對  │
│  □ Whois 查詢   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│    開始分析      │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌───────┐ ┌───────┐
│IP 匹配│ │Whois  │
│       │ │(選用) │
└───┬───┘ └───┬───┘
    │         │
    └────┬────┘
         │
         ▼
┌─────────────────┐
│   顯示分析結果   │
│  • 總筆數       │
│  • 匹配筆數     │
│  • 多IP筆數     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   匯出 Excel    │
└─────────────────┘
```

---

## 輸出報告

### Excel 報告結構

匯出的 Excel 檔案包含以下工作表：

| 工作表名稱 | 內容 |
|-----------|------|
| Summary | 所有交易紀錄（含 IP 匹配結果） |
| Income | 收入交易（如啟用收支分離） |
| Expense | 支出交易（如啟用收支分離） |

### 輸出欄位說明

| 欄位 | 說明 |
|------|------|
| Timestamp | 交易時間 |
| Account | 帳戶識別碼 |
| Income | 收入金額 |
| Expense | 支出金額 |
| Matched IP | 匹配的 IP 位址 |
| IP Country | IP 所屬國家（如啟用 Whois） |
| IP ISP | 網路服務商（如啟用 Whois） |
| Raw Columns... | 原始欄位資料 |

---

## 常見問題

### Q1: Web 版無法載入 WASM 模組？

**症狀**：顯示「Failed to load WASM module」錯誤

**解決方案**：
1. 確認瀏覽器支援 WebAssembly
2. 嘗試重新整理頁面
3. 使用 Chrome 或 Firefox 最新版本

### Q2: Excel 檔案無法解析？

**症狀**：載入檔案時顯示錯誤

**解決方案**：
1. 確認檔案格式為 .xlsx 或 .xls
2. 確認檔案未加密或受密碼保護
3. 確認檔案內有資料且格式正確

### Q3: IP 匹配結果全部是 N/A？

**可能原因**：
1. File A 與 File B 的帳號格式不一致
2. 時間格式無法解析
3. 時間差異超出預設時間窗口

**解決方案**：
1. 確認兩個檔案的帳號欄位格式一致
2. 確認時間格式為標準格式（YYYY-MM-DD HH:MM:SS）
3. 檢查實際時間差異是否在 ±3 秒內

### Q4: Whois 查詢失敗？

**症狀**：IP Country/ISP 欄位為空

**可能原因**：
1. 使用 Web 版本（不支援 Whois）
2. 網路連線問題
3. 查詢的 IP 為私有位址

**解決方案**：
1. 使用桌面版本執行 Whois 查詢
2. 確認網路連線正常
3. 私有 IP 會自動標記為「Private」

### Q5: 如何處理大量資料？

**建議**：
- 單次分析建議不超過 10,000 筆交易
- 大量資料可分批處理
- 桌面版處理效能優於 Web 版

---

## 技術架構

### 整體架構

```
┌─────────────────────────────────────────────────────────┐
│                    Svelte Frontend                       │
│              (src/lib/stores/platform.ts)               │
└──────────────────────┬──────────────────────────────────┘
                       │
         ┌─────────────┴─────────────┐
         │                           │
         ▼                           ▼
┌─────────────────┐         ┌─────────────────┐
│  Tauri Desktop  │         │    Web/WASM     │
│  (tauri-impl)   │         │  (wasm-impl)    │
└────────┬────────┘         └────────┬────────┘
         │                           │
         ▼                           ▼
┌─────────────────┐         ┌─────────────────┐
│  bankflow-core  │         │  bankflow-core  │
│   (native Rust) │         │    (WASM)       │
└─────────────────┘         └─────────────────┘
```

### 核心模組

| 模組 | 功能 |
|------|------|
| `parser.rs` | Excel 檔案解析 |
| `matcher.rs` | IP 時間窗口匹配 |
| `processor.rs` | 資料前處理（敏感欄位、收支分離） |
| `exporter.rs` | Excel 報告匯出 |
| `whois.rs` | IP 地理位置查詢（僅桌面版） |

### 技術棧

| 層級 | 技術 |
|------|------|
| 前端 | Svelte 5 + TypeScript + TailwindCSS |
| 桌面 | Tauri 2.0 |
| 核心 | Rust + WebAssembly |
| 部署 | Vercel (Web) |

---

## 附錄

### 支援的時間格式

系統可自動解析以下時間格式：

- `YYYY-MM-DD HH:MM:SS`（推薦）
- `YYYY/MM/DD HH:MM:SS`
- `DD-MM-YYYY HH:MM:SS`
- Excel 數值日期格式

### 版本歷史

| 版本 | 日期 | 更新內容 |
|------|------|---------|
| 2.0.0 | 2026-01-23 | 雙平台架構、WASM 支援、Vercel 部署 |
| 1.0.0 | 2026-01-21 | 初始版本 |

### 聯絡方式

- **GitHub Issues**：https://github.com/Birdman1972/BankFlow-Tactical-Analyzer/issues
- **專案首頁**：https://github.com/Birdman1972/BankFlow-Tactical-Analyzer

---

**⚠️ 免責聲明**

本工具僅供合法的數位鑑識與資安分析用途。使用者應確保：
1. 擁有分析資料的合法授權
2. 遵守當地法律法規
3. 保護個人隱私資料安全

開發者不對任何非法使用或資料外洩負責。
