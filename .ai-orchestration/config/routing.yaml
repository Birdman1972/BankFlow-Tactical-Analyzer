# 任務路由配置檔
# 定義任務特性與建議代理（實際工具由用戶決定）

version: "2.0"
updated: "2026-01-26"

# ============================================
# 路由規則（依優先順序評估）
# 注意：這些是建議，實際使用哪個工具由用戶決定
# ============================================

rules:
  # UI/UX 設計系統
  - name: "ui_design_system"
    description: "設計系統、UI 架構規劃"
    condition:
      category: [ui_design, design_system]
      complexity: [complex, expert]
    suggested: claude-opus
    reasoning: "Claude 擅長複雜設計架構思考"

  # UI 視覺分析（需要看圖）
  - name: "ui_visual_analysis"
    description: "分析 mockup、截圖、設計稿"
    condition:
      category: [ui_analysis]
      requires_visual: true
    suggested: gemini-pro
    reasoning: "Gemini 多模態能力，可分析圖片"

  # 批量 UI 元件生成
  - name: "ui_component_batch"
    description: "批量生成 UI 元件"
    condition:
      category: [ui_component]
      files_count: "> 3"
    suggested: [gpt-5.2-codex, gpt-5.1-codex-max]
    reasoning: "GPT Codex 批量生成效率高"

  # 簡單樣式調整
  - name: "ui_style_simple"
    description: "簡單的樣式修改"
    condition:
      category: [ui_style]
      complexity: [trivial, simple]
    suggested: gemini-flash
    reasoning: "簡單快速，成本低"

  # 品質檢查（建置測試）
  - name: "quality_check"
    description: "建置測試、TypeScript 檢查、單元測試"
    condition:
      category: [quality_check, build_test, test]
      complexity: [trivial, simple]
    suggested: gemini-flash
    fallback: claude-sonnet
    reasoning: "簡單執行命令，失敗時升級"
    auto_commands:
      - "npm run check"
      - "npm run build:web"

  # 品質檢查（需修復）
  - name: "quality_check_with_fix"
    description: "建置失敗後的除錯與修復"
    condition:
      category: [quality_check, build_test]
      requires_fix: true
    suggested: claude-sonnet
    fallback: claude-opus
    reasoning: "需要理解錯誤並修復程式碼"

  # 翻譯任務
  - name: "translation_tasks"
    description: "翻譯和國際化任務"
    condition:
      requires_translation: true
    suggested: claude-sonnet
    reasoning: "多語言支援佳"

  # 架構設計
  - name: "architecture_design"
    description: "複雜架構和系統設計"
    condition:
      complexity: [complex, expert]
      category: [architecture, design]
    suggested: claude-opus
    reasoning: "Claude Opus 深度推理能力最強"

  # 程式碼審查
  - name: "code_review"
    description: "程式碼審查任務"
    condition:
      category: review
    suggested: claude-opus
    reasoning: "Claude 提供最完整的程式碼分析"

  # 複雜除錯
  - name: "complex_debugging"
    description: "複雜的除錯任務"
    condition:
      category: debugging
      complexity: [complex, expert]
    suggested: gemini-pro
    fallback: claude-opus
    reasoning: "延伸思考模式有助於複雜除錯"

  # 批量修改
  - name: "batch_modifications"
    description: "多檔案批量修改"
    condition:
      category: [refactor, batch_modify]
      files_count: "> 3"
    suggested: [gpt-5.2-codex, gpt-5.1-codex-max]
    reasoning: "GPT Codex 批量修改效率高"

  # 簡單文件
  - name: "simple_docs"
    description: "簡單的文件撰寫"
    condition:
      complexity: [trivial, simple]
      category: docs
    suggested: [gemini-flash, gpt-5.1-codex-mini]
    reasoning: "快速且成本低"

  # 中等複雜度
  - name: "moderate_tasks"
    description: "中等複雜度的一般任務"
    condition:
      complexity: moderate
    suggested: claude-sonnet
    reasoning: "平衡速度與品質"

  # 預設規則
  - name: "default"
    description: "預設分派"
    condition: {}
    suggested: claude-sonnet
    reasoning: "平衡的預設選擇"

# ============================================
# 品質控制
# ============================================

quality_gates:
  auto_checks:
    - name: typescript
      command: "npm run check"
      required: true
      timeout: 60

    - name: build_web
      command: "npm run build:web"
      required: true
      timeout: 120

    - name: rust_tests
      command: "cargo test -p bankflow-core"
      required: false
      timeout: 180

  human_review:
    always_required:
      - architecture
      - security
    recommended:
      - i18n
      - api_changes
    optional:
      - bugfix
      - docs

  guardian_protocol:
    enabled: true
    max_consecutive_failures: 5
    actions:
      - stop_current_task
      - notify_human
      - create_debug_snapshot

# ============================================
# 任務分類定義
# ============================================

classifications:
  complexity:
    - trivial     # 極簡單（改錯字、調格式）
    - simple      # 簡單（小功能、小修改）
    - moderate    # 中等（一般功能）
    - complex     # 複雜（跨模組、需設計）
    - expert      # 專家級（架構、演算法）

  category:
    - feature         # 新功能
    - bugfix          # 修復錯誤
    - refactor        # 重構
    - docs            # 文件
    - i18n            # 國際化
    - test            # 測試
    - review          # 審查
    - architecture    # 架構設計
    - debugging       # 除錯
    - batch_modify    # 批量修改
    - security        # 安全相關
    - quality_check   # 品質檢查
    - build_test      # 建置測試
    - ui_design       # UI 設計
    - ui_component    # UI 元件
    - ui_style        # UI 樣式
    - ui_analysis     # UI 分析

  priority:
    - critical   # 緊急
    - high       # 高
    - medium     # 中
    - low        # 低
