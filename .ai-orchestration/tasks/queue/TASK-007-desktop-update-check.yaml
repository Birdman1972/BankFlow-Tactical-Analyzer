# 桌面版更新檢查任務
# Tauri 桌面版啟動時檢查版本並顯示更新通知

id: "TASK-007"
created: "2026-01-26T10:25:00+08:00"

# ============================================
# 任務基本資訊
# ============================================

metadata:
  title: "桌面版啟動時版本檢查與更新通知"
  description: |
    在 Tauri 桌面版啟動時：
    1. 從遠端（Vercel）取得 version.json
    2. 比對本地版本與遠端版本
    3. 若有新版本，顯示 UpdateDialog

    需要：
    1. 建立版本檢查服務 (versionService.ts)
    2. 在 App.svelte 啟動時呼叫版本檢查
    3. 整合已完成的 UpdateDialog 元件
    4. 處理「略過此版本」的偏好設定（localStorage）
  category: feature
  priority: medium
  tags:
    - tauri
    - desktop
    - version-check
    - update

# ============================================
# 任務分類（用於路由）
# ============================================

classification:
  complexity: moderate
  domain: frontend
  languages:
    - typescript
    - svelte
  requires_reasoning: true
  requires_translation: false
  pattern_based: false
  files_count: 3

# ============================================
# 路由決策
# ============================================

routing:
  suggested_agent: claude-sonnet
  reasoning: "需要理解 Tauri 平台偵測邏輯，中等複雜度"
  override: false

# ============================================
# 輸入脈絡
# ============================================

context:
  files:
    - path: "src/App.svelte"
      reason: "主應用元件，需在啟動時呼叫版本檢查"
    - path: "src/lib/components/UpdateDialog.svelte"
      reason: "已完成的更新對話框元件"
    - path: "src/lib/stores/platform.ts"
      reason: "平台偵測邏輯參考"
    - path: "static/version.json"
      reason: "版本資訊格式參考"
  references:
    - url: "https://bankflow-tactical-analyzer.vercel.app/version.json"
      reason: "遠端版本資訊來源"

# ============================================
# 需求定義
# ============================================

requirements:
  functional:
    - "建立 versionService.ts 版本檢查服務"
    - "checkForUpdate() 函數：取得遠端版本並比對"
    - "僅在 Tauri 桌面版執行版本檢查"
    - "Web 版本不執行版本檢查（已是最新）"
    - "若有新版本，顯示 UpdateDialog"
    - "「略過此版本」功能：記錄到 localStorage"
    - "「稍後提醒」功能：本次啟動不再顯示"
    - "「立即更新」功能：開啟瀏覽器下載頁面"
  non_functional:
    - "使用 Svelte 5 runes 語法"
    - "版本比對使用 semver 邏輯"
    - "網路錯誤時靜默失敗（不影響使用）"
  constraints:
    - "不要修改 UpdateDialog 的內部邏輯"
    - "使用 $state 時需用 let 而非 const"

# ============================================
# 驗收標準
# ============================================

acceptance:
  checklist:
    - "[ ] versionService.ts 建立完成"
    - "[ ] Tauri 桌面版啟動時檢查版本"
    - "[ ] Web 版本不執行檢查"
    - "[ ] 有新版本時顯示 UpdateDialog"
    - "[ ] 「略過此版本」功能正常"
    - "[ ] 網路錯誤時不影響應用"
    - "[ ] TypeScript 檢查通過"
    - "[ ] 建置成功"
  test_commands:
    - "npm run check"
    - "npm run build:web"

# ============================================
# 輸出規範
# ============================================

output:
  directory: ".ai-orchestration/outputs/TASK-007"
  expected_files:
    - "versionService.ts"
    - "App.svelte.patch"

# ============================================
# 狀態追蹤
# ============================================

status: completed

execution:
  attempts: 1
  max_attempts: 3
  history:
    - date: "2026-01-26T10:35:00+08:00"
      agent: "Gemini CLI (NetOps Architect)"
      result: "Success"
      details: "Integrated version check into App.svelte. Updated versionService.ts with skip logic. Rendered UpdateDialog."
